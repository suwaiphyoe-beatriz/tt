# 前端编程思路
## 1. 状态管理

```jsx
const [filters, setFilters] = useState({
  country: '',
  mainIngredient: '',
  allergen: ''
});

const [availableOptions, setAvailableOptions] = useState({
  countries: [],
  mainIngredients: [],
  allergens: []
});
```

## 2. 筛选组件结构
```jsx
function FilterSection() {
  return (
    <div className="bg-white p-4 rounded-lg shadow-md mb-6">
      <h2 className="text-xl font-semibold mb-4">筛选食谱</h2>
      
      {/* 国家筛选 */}
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          国家/菜系
        </label>
        <select
          value={filters.country}
          onChange={(e) => setFilters({...filters, country: e.target.value})}
          className="w-full p-2 border border-gray-300 rounded-md"
        >
          <option value="">全部</option>
          {availableOptions.countries.map(country => (
            <option key={country} value={country}>{country}</option>
          ))}
        </select>
      </div>

      {/* 主食材筛选 */}
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          主食材
        </label>
        <select
          value={filters.mainIngredient}
          onChange={(e) => setFilters({...filters, mainIngredient: e.target.value})}
          className="w-full p-2 border border-gray-300 rounded-md"
        >
          <option value="">全部</option>
          {availableOptions.mainIngredients.map(ingredient => (
            <option key={ingredient} value={ingredient}>{ingredient}</option>
          ))}
        </select>
      </div>

      {/* 过敏原筛选 */}
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          排除过敏原
        </label>
        <select
          value={filters.allergen}
          onChange={(e) => setFilters({...filters, allergen: e.target.value})}
          className="w-full p-2 border border-gray-300 rounded-md"
        >
          <option value="">无过敏原限制</option>
          {availableOptions.allergens.map(allergen => (
            <option key={allergen} value={allergen}>不含 {allergen}</option>
          ))}
        </select>
      </div>

      {/* 重置按钮 */}
      <button
        onClick={() => setFilters({country: '', mainIngredient: '', allergen: ''})}
        className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md"
      >
        重置筛选
      </button>
    </div>
  );
}
```

## 3. 数据获取逻辑

```jsx
// 获取筛选选项
useEffect(() => {
  const fetchFilterOptions = async () => {
    try {
      const response = await fetch('http://localhost:5000/api/recipes/filter-options');
      const data = await response.json();
      setAvailableOptions(data);
    } catch (error) {
      console.error('Error fetching filter options:', error);
    }
  };
  fetchFilterOptions();
}, []);

// 根据筛选条件获取菜谱ID
useEffect(() => {
  const fetchFilteredRecipes = async () => {
    try {
      setLoading(true);
      
      // 构建查询参数
      const params = new URLSearchParams();
      if (filters.country) params.append('country', filters.country);
      if (filters.mainIngredient) params.append('mainIngredient', filters.mainIngredient);
      if (filters.allergen) params.append('excludeAllergen', filters.allergen);

      const response = await fetch(`http://localhost:5000/api/recipes?${params}`);
      const recipes = await response.json();
      
      const ids = recipes.map(recipe => recipe.id);
      setRecipeIds(ids);
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  // 添加防抖，避免频繁请求
  const timeoutId = setTimeout(fetchFilteredRecipes, 300);
  return () => clearTimeout(timeoutId);
}, [filters]);
```

# 后端API设计

## 1. 获取筛选选项端点

```jsx
// GET /api/recipes/filter-options
app.get('/api/recipes/filter-options', async (req, res) => {
  try {
    // 从数据库获取所有可选值
    const countries = await Recipe.distinct('country');
    const mainIngredients = await Recipe.distinct('mainIngredients');
    const allergens = await Recipe.distinct('allergens');
    
    res.json({
      countries: countries.filter(Boolean).sort(),
      mainIngredients: mainIngredients.filter(Boolean).sort(),
      allergens: allergens.filter(Boolean).sort()
    });
  } catch (error) {
    res.status(500).json({ error: 'Internal server error' });
  }
});
```

## 2. 筛选菜谱端点

```jsx
// GET /api/recipes?country=Italian&country=Chinese&mainIngredient=Pasta&excludeAllergen=Gluten
app.get('/api/recipes', async (req, res) => {
  try {
    const { country, mainIngredient, excludeAllergen } = req.query;
    
    // 构建查询条件 - 支持多选
    let query = {};
    
    if (country) {
      // 处理多个国家的情况
      const countries = Array.isArray(country) ? country : [country];
      query.country = { $in: countries };
    }
    
    if (mainIngredient) {
      // 处理多个主食材的情况
      const ingredients = Array.isArray(mainIngredient) ? mainIngredient : [mainIngredient];
      query.mainIngredients = { $in: ingredients };
    }
    
    if (excludeAllergen) {
      // 处理多个过敏原的情况
      const allergens = Array.isArray(excludeAllergen) ? excludeAllergen : [excludeAllergen];
      query.allergens = { $not: { $in: allergens } };
    }
    
    // 执行查询
    const recipes = await Recipe.find(query)
      .select('id title image rating cookTime country mainIngredients allergens')
      .sort({ createdAt: -1 });
    
    res.json(recipes);
  } catch (error) {
    res.status(500).json({ error: 'Internal server error' });
  }
});
```

# 数据库模型示例
```jsx
const recipeSchema = new mongoose.Schema({
  title: String,
  image: String,
  rating: Number,
  cookTime: String,
  description: String,
  isBookmarked: Boolean,
  
  // 筛选相关字段
  country: String,           // 国家/菜系：Italian, Chinese, Mexican等
  mainIngredients: [String], // 主食材：Chicken, Pasta, Rice, Vegetables等
  allergens: [String],       // 过敏原：Gluten, Dairy, Nuts, Seafood等
  
  // 其他字段...
  ingredients: [String],
  instructions: [String],
  createdAt: { type: Date, default: Date.now }
});
```














